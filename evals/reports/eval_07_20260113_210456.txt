================================================================================
EVAL 07: END-TO-END USER EXPERIENCE
================================================================================

This eval demonstrates the package as a real analyst would use it.
Scenario: Loan application with heterogeneous rate sensitivity.

Settings: n=1000, seed=42, n_bootstrap=50, n_folds=20

--------------------------------------------------------------------------------
PART A: DATA GENERATION
--------------------------------------------------------------------------------

DGP:
  α(x) = 0.50 + 0.30*income + 0.20*credit + 0.10*age
  β(x) = -0.80 + -0.10*income + -0.20*credit + 0.05*age
  P(Y=1|X,T) = sigmoid(α(X) + β(X)*T)

  True μ* = E[β(X)] = -0.800000
  True AME = E[p(1-p)·β] = -0.182706
  Mean(Y) = 0.615
  Heterogeneity CV = 0.275

--------------------------------------------------------------------------------
PART B: ORACLE INFERENCE (Bootstrap)
--------------------------------------------------------------------------------

Fitting Oracle logit with interactions...
  Oracle μ̂ = -0.812103
  Oracle SE (delta) = 0.078824

Running bootstrap (B=50)...
Bootstrap:   0%|          | 0/50 [00:00<?, ?it/s]Bootstrap:   6%|▌         | 3/50 [00:00<00:02, 19.94it/s]Bootstrap:  12%|█▏        | 6/50 [00:00<00:01, 23.57it/s]Bootstrap:  28%|██▊       | 14/50 [00:00<00:00, 43.75it/s]Bootstrap:  38%|███▊      | 19/50 [00:00<00:00, 44.93it/s]Bootstrap:  48%|████▊     | 24/50 [00:00<00:00, 37.45it/s]Bootstrap:  62%|██████▏   | 31/50 [00:00<00:00, 44.09it/s]Bootstrap:  72%|███████▏  | 36/50 [00:00<00:00, 37.77it/s]Bootstrap:  82%|████████▏ | 41/50 [00:01<00:00, 38.79it/s]Bootstrap:  92%|█████████▏| 46/50 [00:01<00:00, 37.80it/s]Bootstrap: 100%|██████████| 50/50 [00:01<00:00, 30.42it/s]Bootstrap: 100%|██████████| 50/50 [00:01<00:00, 35.23it/s]
/Users/pranjal/deepest/src/deep_inference/core/algorithm.py:342: UserWarning: High correction variance ratio (32.23). This suggests the influence function correction dominates the estimate variance. Consider using more cross-fitting folds (K >= 50).
  warnings.warn(
  Bootstrap μ̂ = -0.821770
  Bootstrap SE = 0.078842
  Bootstrap 95% CI = [-0.9661, -0.6740]

--------------------------------------------------------------------------------
PART C: NN INFERENCE (structural_dml)
--------------------------------------------------------------------------------

Running structural_dml(family='logit', n_folds=20, epochs=50)...
  NN μ̂ (naive) = -0.800657
  NN μ̂ (IF) = -0.830460
  NN SE = 0.079339
  NN 95% CI = [-0.9860, -0.6750]

--------------------------------------------------------------------------------
PART D: COMPARISON
--------------------------------------------------------------------------------

================================================================================
COMPARISON TABLE: Target μ* = E[β(X)]
================================================================================
True μ* = -0.800000

Method                        Estimate         SE      CI_lo      CI_hi   Covers
--------------------------------------------------------------------------------
Oracle (Naive SE)            -0.812103   0.078436    -0.9658    -0.6584      YES
Oracle (Delta SE)            -0.812103   0.078824    -0.9666    -0.6576      YES
Bootstrap Oracle             -0.821770   0.078842    -0.9661    -0.6740      YES
NN (Naive)                   -0.800657   0.016315    -0.8326    -0.7687      YES
NN (IF Corrected)            -0.830460   0.079339    -0.9860    -0.6750      YES
================================================================================

--------------------------------------------------------------------------------
PART E: HETEROGENEITY ANALYSIS
--------------------------------------------------------------------------------

================================================================================
HETEROGENEITY ANALYSIS: β(x) = Rate Sensitivity
================================================================================

--- Correlation with True β(x) ---
  Oracle β̂(x): 0.7319
  NN β̂(x):     0.4124

--- Distribution of β̂(x) ---
Statistic               True       Oracle           NN
-------------------------------------------------------
Mean                 -0.8158      -0.8121      -0.8007
Std                   0.2240       0.3274       0.5159
Min                  -1.5352      -1.8905      -3.4398
Q10                  -1.1014      -1.2339      -1.4792
Median               -0.8099      -0.8097      -0.6626
Q90                  -0.5343      -0.3852      -0.2771
Max                  -0.0793       0.2791       0.2138

CV                    0.2746       0.4031       0.6444

--- Bootstrap CIs for β(x_i) (sample of 10) ---
    i       True     Oracle    Boot_lo    Boot_hi         NN   Covers
----------------------------------------------------------------------
  521    -0.8215    -0.1571    -0.6777     0.3559    -1.0444       NO
  737    -0.6676    -0.6854    -0.9373    -0.4418    -0.4032      YES
  740    -0.5743    -0.4220    -0.8476    -0.1173    -0.5316      YES
  660    -1.0648    -1.2327    -1.5434    -0.9753    -0.5043      YES
  411    -0.7219    -0.3149    -0.7139     0.0274    -0.5878       NO
  678    -1.0885    -1.0499    -1.3101    -0.7235    -1.1878      YES
  626    -0.5414    -0.2217    -0.6362    -0.0090    -0.4016      YES
  513    -0.3487    -0.4702    -0.9181    -0.1110    -0.8628      YES
  859    -0.9057    -0.8732    -1.0814    -0.7015    -0.5241      YES
  136    -0.9545    -0.8414    -1.1868    -0.5768    -0.6135      YES

Bootstrap coverage for β(x): 87.6%
================================================================================

--------------------------------------------------------------------------------
PART F: VALIDATION
--------------------------------------------------------------------------------

================================================================================
VALIDATION CHECKS
================================================================================

  Oracle CI covers μ*: PASS
  Bootstrap CI covers μ*: PASS
  NN IF CI covers μ*: PASS
  NN IF |bias| < 0.1: PASS
  Corr(β̂_oracle, β_true) > 0.8: FAIL
  Corr(β̂_nn, β_true) > 0.8: FAIL
  Bootstrap θ(x) coverage > 80%: PASS

  Result: 5/7 checks passed
================================================================================

================================================================================
EVAL 07: 5/7 CHECKS PASSED
================================================================================
