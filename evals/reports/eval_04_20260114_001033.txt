======================================================================
EVAL 04: TARGET JACOBIAN (EXPANDED)
======================================================================

Tests autodiff ∂H/∂θ against closed-form oracle formulas
across multiple targets, families, and edge cases.

======================================================================
PART 1: TARGET COVERAGE (Family = Logit)
======================================================================

--- 1a. AverageParameter: H(θ) = β ---
  θ=[0. 1.], t̃=0.0
    H(θ) = 1.000000
    Oracle:   [0.000000, 1.000000]
    Autodiff: [0.000000, 1.000000]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[1.  0.5], t̃=0.0
    H(θ) = 0.500000
    Oracle:   [0.000000, 1.000000]
    Autodiff: [0.000000, 1.000000]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[-0.5  2. ], t̃=0.0
    H(θ) = 2.000000
    Oracle:   [0.000000, 1.000000]
    Autodiff: [0.000000, 1.000000]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[ 0.1 -1. ], t̃=0.0
    H(θ) = -1.000000
    Oracle:   [0.000000, 1.000000]
    Autodiff: [0.000000, 1.000000]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[2.  0.1], t̃=0.0
    H(θ) = 0.100000
    Oracle:   [0.000000, 1.000000]
    Autodiff: [0.000000, 1.000000]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]

--- 1b. AME Logit: H(θ) = σ(α+βt̃)(1-σ)β ---
  θ=[0. 1.], t̃=0.0
    H(θ) = 0.250000
    Oracle:   [0.000000, 0.250000]
    Autodiff: [0.000000, 0.250000]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[0. 1.], t̃=0.5
    H(θ) = 0.235004
    Oracle:   [-0.057557, 0.206225]
    Autodiff: [-0.057557, 0.206225]
    Abs Err: 6.94e-18, Rel Err: 3.36e-17 [PASS]
  θ=[0. 1.], t̃=-1.0
    H(θ) = 0.196612
    Oracle:   [0.090858, 0.105754]
    Autodiff: [0.090858, 0.105754]
    Abs Err: 1.39e-17, Rel Err: 1.31e-16 [PASS]
  θ=[0. 1.], t̃=2.0
    H(θ) = 0.104994
    Oracle:   [-0.079963, -0.054931]
    Autodiff: [-0.079963, -0.054931]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[1.  0.5], t̃=0.0
    H(θ) = 0.098306
    Oracle:   [-0.045429, 0.196612]
    Autodiff: [-0.045429, 0.196612]
    Abs Err: 6.94e-18, Rel Err: 3.53e-17 [PASS]
  θ=[1.  0.5], t̃=0.5
    H(θ) = 0.086552
    Oracle:   [-0.048002, 0.149104]
    Autodiff: [-0.048002, 0.149104]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[1.  0.5], t̃=-1.0
    H(θ) = 0.117502
    Oracle:   [-0.028778, 0.263782]
    Autodiff: [-0.028778, 0.263782]
    Abs Err: 3.47e-18, Rel Err: 1.32e-17 [PASS]
  θ=[1.  0.5], t̃=2.0
    H(θ) = 0.052497
    Oracle:   [-0.039981, 0.025031]
    Autodiff: [-0.039981, 0.025031]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[-0.5  2. ], t̃=0.0
    H(θ) = 0.470007
    Oracle:   [0.115114, 0.235004]
    Autodiff: [0.115114, 0.235004]
    Abs Err: 1.39e-17, Rel Err: 5.91e-17 [PASS]
  θ=[-0.5  2. ], t̃=0.5
    H(θ) = 0.470007
    Oracle:   [-0.115114, 0.177447]
    Autodiff: [-0.115114, 0.177447]
    Abs Err: 2.78e-17, Rel Err: 1.56e-16 [PASS]
  θ=[-0.5  2. ], t̃=-1.0
    H(θ) = 0.140207
    Oracle:   [0.118936, -0.048832]
    Autodiff: [0.118936, -0.048832]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[-0.5  2. ], t̃=2.0
    H(θ) = 0.056906
    Oracle:   [-0.053570, -0.078687]
    Autodiff: [-0.053570, -0.078687]
    Abs Err: 1.39e-17, Rel Err: 1.76e-16 [PASS]
  θ=[ 0.1 -1. ], t̃=0.0
    H(θ) = -0.249376
    Oracle:   [0.012458, 0.249376]
    Autodiff: [0.012458, 0.249376]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[ 0.1 -1. ], t̃=0.5
    H(θ) = -0.240261
    Oracle:   [-0.047422, 0.216550]
    Autodiff: [-0.047422, 0.216550]
    Abs Err: 6.94e-18, Rel Err: 3.20e-17 [PASS]
  θ=[ 0.1 -1. ], t̃=-1.0
    H(θ) = -0.187370
    Oracle:   [0.093782, 0.093587]
    Autodiff: [0.093782, 0.093587]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[ 0.1 -1. ], t̃=2.0
    H(θ) = -0.113180
    Oracle:   [-0.083729, -0.054277]
    Autodiff: [-0.083729, -0.054277]
    Abs Err: 2.78e-17, Rel Err: 3.31e-16 [PASS]
  θ=[2.  0.1], t̃=0.0
    H(θ) = 0.010499
    Oracle:   [-0.007996, 0.104994]
    Autodiff: [-0.007996, 0.104994]
    Abs Err: 1.73e-18, Rel Err: 1.65e-17 [PASS]
  θ=[2.  0.1], t̃=0.5
    H(θ) = 0.010104
    Oracle:   [-0.007800, 0.097145]
    Autodiff: [-0.007800, 0.097145]
    Abs Err: 1.73e-18, Rel Err: 1.79e-17 [PASS]
  θ=[2.  0.1], t̃=-1.0
    H(θ) = 0.011318
    Oracle:   [-0.008373, 0.121553]
    Autodiff: [-0.008373, 0.121553]
    Abs Err: 1.73e-18, Rel Err: 1.43e-17 [PASS]
  θ=[2.  0.1], t̃=2.0
    H(θ) = 0.008980
    Oracle:   [-0.007189, 0.075423]
    Autodiff: [-0.007189, 0.075423]
    Abs Err: 1.73e-18, Rel Err: 2.30e-17 [PASS]

--- 1c. Prediction Logit: H(θ) = σ(α+βt̃) ---
  θ=[0. 1.], t̃=0.0
    H(θ) = 0.500000
    Oracle:   [0.250000, 0.000000]
    Autodiff: [0.250000, 0.000000]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[0. 1.], t̃=0.5
    H(θ) = 0.622459
    Oracle:   [0.235004, 0.117502]
    Autodiff: [0.235004, 0.117502]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[0. 1.], t̃=-1.0
    H(θ) = 0.268941
    Oracle:   [0.196612, -0.196612]
    Autodiff: [0.196612, -0.196612]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[0. 1.], t̃=2.0
    H(θ) = 0.880797
    Oracle:   [0.104994, 0.209987]
    Autodiff: [0.104994, 0.209987]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[1.  0.5], t̃=0.0
    H(θ) = 0.731059
    Oracle:   [0.196612, 0.000000]
    Autodiff: [0.196612, 0.000000]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[1.  0.5], t̃=0.5
    H(θ) = 0.777300
    Oracle:   [0.173105, 0.086552]
    Autodiff: [0.173105, 0.086552]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[1.  0.5], t̃=-1.0
    H(θ) = 0.622459
    Oracle:   [0.235004, -0.235004]
    Autodiff: [0.235004, -0.235004]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[1.  0.5], t̃=2.0
    H(θ) = 0.880797
    Oracle:   [0.104994, 0.209987]
    Autodiff: [0.104994, 0.209987]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[-0.5  2. ], t̃=0.0
    H(θ) = 0.377541
    Oracle:   [0.235004, 0.000000]
    Autodiff: [0.235004, 0.000000]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[-0.5  2. ], t̃=0.5
    H(θ) = 0.622459
    Oracle:   [0.235004, 0.117502]
    Autodiff: [0.235004, 0.117502]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[-0.5  2. ], t̃=-1.0
    H(θ) = 0.075858
    Oracle:   [0.070104, -0.070104]
    Autodiff: [0.070104, -0.070104]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[-0.5  2. ], t̃=2.0
    H(θ) = 0.970688
    Oracle:   [0.028453, 0.056906]
    Autodiff: [0.028453, 0.056906]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[ 0.1 -1. ], t̃=0.0
    H(θ) = 0.524979
    Oracle:   [0.249376, 0.000000]
    Autodiff: [0.249376, 0.000000]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[ 0.1 -1. ], t̃=0.5
    H(θ) = 0.401312
    Oracle:   [0.240261, 0.120130]
    Autodiff: [0.240261, 0.120130]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[ 0.1 -1. ], t̃=-1.0
    H(θ) = 0.750260
    Oracle:   [0.187370, -0.187370]
    Autodiff: [0.187370, -0.187370]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[ 0.1 -1. ], t̃=2.0
    H(θ) = 0.130108
    Oracle:   [0.113180, 0.226361]
    Autodiff: [0.113180, 0.226361]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[2.  0.1], t̃=0.0
    H(θ) = 0.880797
    Oracle:   [0.104994, 0.000000]
    Autodiff: [0.104994, 0.000000]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[2.  0.1], t̃=0.5
    H(θ) = 0.885948
    Oracle:   [0.101044, 0.050522]
    Autodiff: [0.101044, 0.050522]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[2.  0.1], t̃=-1.0
    H(θ) = 0.869892
    Oracle:   [0.113180, -0.113180]
    Autodiff: [0.113180, -0.113180]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[2.  0.1], t̃=2.0
    H(θ) = 0.900250
    Oracle:   [0.089800, 0.179601]
    Autodiff: [0.089800, 0.179601]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]

Part 1 Summary: 45/45 passed, max|err| = 2.78e-17

======================================================================
PART 2: FAMILY COVERAGE (Target = AME)
======================================================================

--- 2a. Linear AME: H(θ) = β ---
  θ=[0. 1.], t̃=0.0
    H(θ) = 1.000000
    Oracle:   [0.000000, 1.000000]
    Autodiff: [0.000000, 1.000000]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[1.  0.5], t̃=0.0
    H(θ) = 0.500000
    Oracle:   [0.000000, 1.000000]
    Autodiff: [0.000000, 1.000000]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[-0.5  2. ], t̃=0.0
    H(θ) = 2.000000
    Oracle:   [0.000000, 1.000000]
    Autodiff: [0.000000, 1.000000]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[ 0.1 -1. ], t̃=0.0
    H(θ) = -1.000000
    Oracle:   [0.000000, 1.000000]
    Autodiff: [0.000000, 1.000000]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[2.  0.1], t̃=0.0
    H(θ) = 0.100000
    Oracle:   [0.000000, 1.000000]
    Autodiff: [0.000000, 1.000000]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]

--- 2b. Poisson AME: H(θ) = β·exp(α+βt̃) ---
  θ=[0. 1.], t̃=0.0
    H(θ) = 1.000000
    Oracle:   [1.000000, 1.000000]
    Autodiff: [1.000000, 1.000000]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[0. 1.], t̃=0.5
    H(θ) = 1.648721
    Oracle:   [1.648721, 2.473082]
    Autodiff: [1.648721, 2.473082]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[1.  0.5], t̃=0.0
    H(θ) = 1.359141
    Oracle:   [1.359141, 2.718282]
    Autodiff: [1.359141, 2.718282]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[1.  0.5], t̃=0.5
    H(θ) = 1.745171
    Oracle:   [1.745171, 4.362929]
    Autodiff: [1.745171, 4.362929]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[-0.5  2. ], t̃=0.0
    H(θ) = 1.213061
    Oracle:   [1.213061, 0.606531]
    Autodiff: [1.213061, 0.606531]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[-0.5  2. ], t̃=0.5
    H(θ) = 3.297443
    Oracle:   [3.297443, 3.297443]
    Autodiff: [3.297443, 3.297443]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[ 0.1 -1. ], t̃=0.0
    H(θ) = -1.105171
    Oracle:   [-1.105171, 1.105171]
    Autodiff: [-1.105171, 1.105171]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[ 0.1 -1. ], t̃=0.5
    H(θ) = -0.670320
    Oracle:   [-0.670320, 0.335160]
    Autodiff: [-0.670320, 0.335160]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[2.  0.1], t̃=0.0
    H(θ) = 0.738906
    Oracle:   [0.738906, 7.389056]
    Autodiff: [0.738906, 7.389056]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[2.  0.1], t̃=0.5
    H(θ) = 0.776790
    Oracle:   [0.776790, 8.156296]
    Autodiff: [0.776790, 8.156296]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]

--- 2c. Probit AME: H(θ) = φ(α+βt̃)·β ---
  θ=[0. 1.], t̃=0.0
    H(θ) = 0.398942
    Oracle:   [-0.000000, 0.398942]
    Autodiff: [0.000000, 0.398942]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[0. 1.], t̃=0.5
    H(θ) = 0.352065
    Oracle:   [-0.176033, 0.264049]
    Autodiff: [-0.176033, 0.264049]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[1.  0.5], t̃=0.0
    H(θ) = 0.120985
    Oracle:   [-0.120985, 0.241971]
    Autodiff: [-0.120985, 0.241971]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[1.  0.5], t̃=0.5
    H(θ) = 0.091325
    Oracle:   [-0.114156, 0.125571]
    Autodiff: [-0.114156, 0.125571]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[-0.5  2. ], t̃=0.0
    H(θ) = 0.704131
    Oracle:   [0.352065, 0.352065]
    Autodiff: [0.352065, 0.352065]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[-0.5  2. ], t̃=0.5
    H(θ) = 0.704131
    Oracle:   [-0.352065, 0.176033]
    Autodiff: [-0.352065, 0.176033]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[ 0.1 -1. ], t̃=0.0
    H(θ) = -0.396953
    Oracle:   [0.039695, 0.396953]
    Autodiff: [0.039695, 0.396953]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[ 0.1 -1. ], t̃=0.5
    H(θ) = -0.368270
    Oracle:   [-0.147308, 0.294616]
    Autodiff: [-0.147308, 0.294616]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[2.  0.1], t̃=0.0
    H(θ) = 0.005399
    Oracle:   [-0.010798, 0.053991]
    Autodiff: [-0.010798, 0.053991]
    Abs Err: 1.73e-18, Rel Err: 3.21e-17 [PASS]
  θ=[2.  0.1], t̃=0.5
    H(θ) = 0.004879
    Oracle:   [-0.010002, 0.043791]
    Autodiff: [-0.010002, 0.043791]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]

Part 2 Summary: 25/25 passed, max|err| = 1.73e-18

======================================================================
PART 3: EDGE CASES (AME × Logit)
======================================================================

--- Near-boundary and extreme θ values ---
  θ=[5. 1.], t̃=0.0
    H(θ) = 0.006648
    Oracle:   [-0.006559, 0.006648]
    Autodiff: [-0.006559, 0.006648]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[5. 1.], t̃=0.5
    H(θ) = 0.004054
    Oracle:   [-0.004021, 0.002043]
    Autodiff: [-0.004021, 0.002043]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[-5.  1.], t̃=0.0
    H(θ) = 0.006648
    Oracle:   [0.006559, 0.006648]
    Autodiff: [0.006559, 0.006648]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[-5.  1.], t̃=0.5
    H(θ) = 0.010866
    Oracle:   [0.010627, 0.016180]
    Autodiff: [0.010627, 0.016180]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[0.    0.001], t̃=0.0
    H(θ) = 0.000250
    Oracle:   [0.000000, 0.250000]
    Autodiff: [0.000000, 0.250000]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[0.    0.001], t̃=0.5
    H(θ) = 0.000250
    Oracle:   [-0.000000, 0.250000]
    Autodiff: [-0.000000, 0.250000]
    Abs Err: 1.43e-20, Rel Err: 5.73e-20 [PASS]
  θ=[ 0. 10.], t̃=0.0
    H(θ) = 2.500000
    Oracle:   [0.000000, 0.250000]
    Autodiff: [0.000000, 0.250000]
    Abs Err: 0.00e+00, Rel Err: 0.00e+00 [PASS]
  θ=[ 0. 10.], t̃=0.5
    H(θ) = 0.066481
    Oracle:   [-0.065591, -0.026147]
    Autodiff: [-0.065591, -0.026147]
    Abs Err: 1.39e-17, Rel Err: 2.12e-16 [PASS]

Part 3 Summary: 8/8 passed, 8/8 finite, max|err| = 1.39e-17

======================================================================
PART 4: BATCHED VMAP TESTS (n=100 each)
======================================================================

  AvgParam (n=100, t̃=0.0): max=0.00e+00, mean=0.00e+00 [PASS]
  AME_Logit_t0 (n=100, t̃=0.0): max=4.16e-17, mean=3.99e-18 [PASS]
  AME_Logit_t05 (n=100, t̃=0.5): max=5.55e-17, mean=6.47e-18 [PASS]
  Pred_Logit_t0 (n=100, t̃=0.0): max=0.00e+00, mean=0.00e+00 [PASS]
  Pred_Logit_t05 (n=100, t̃=0.5): max=0.00e+00, mean=0.00e+00 [PASS]
  AME_Linear (n=100, t̃=0.0): max=0.00e+00, mean=0.00e+00 [PASS]
  AME_Poisson_t0 (n=100, t̃=0.0): max=0.00e+00, mean=0.00e+00 [PASS]
  AME_Poisson_t05 (n=100, t̃=0.5): max=1.78e-15, mean=5.70e-17 [PASS]
  AME_Probit_t0 (n=100, t̃=0.0): max=5.55e-17, mean=4.24e-18 [PASS]
  AME_Probit_t05 (n=100, t̃=0.5): max=5.55e-17, mean=1.18e-17 [PASS]
  Pred_Linear_t0 (n=100, t̃=0.0): max=0.00e+00, mean=0.00e+00 [PASS]
  Pred_Linear_t05 (n=100, t̃=0.5): max=0.00e+00, mean=0.00e+00 [PASS]
  Pred_Poisson_t0 (n=100, t̃=0.0): max=0.00e+00, mean=0.00e+00 [PASS]
  Pred_Probit_t0 (n=100, t̃=0.0): max=1.11e-16, mean=2.35e-17 [PASS]

Part 4 Summary: 14/14 passed, max|err| = 1.78e-15

======================================================================
SUMMARY TABLE
======================================================================
Part                      Tests      Passed     Max Error       Status    
----------------------------------------------------------------------
1: Targets (Logit)        45         45         2.78e-17        PASS      
2: Families (AME)         25         25         1.73e-18        PASS      
3: Edge Cases             8          8          1.39e-17        PASS      
4: Batched vmap           14         14         1.78e-15        PASS      
----------------------------------------------------------------------
TOTAL                     92         92         1.78e-15       

======================================================================
EVAL 04: PASS
======================================================================
